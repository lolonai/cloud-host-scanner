<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cloud Host Scanner - Shodan</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg: #0f1419;
        --surface: #1a1f2e;
        --border: #2d3748;
        --text: #e2e8f0;
        --muted: #a0aec0;
        --accent: #667eea;
        --success: #48bb78;
        --warning: #ed8936;
        --danger: #f56565;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
        padding: 20px;
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
      }

      /* Header */
      header {
        background: var(--surface);
        padding: 40px;
        border-radius: 16px;
        margin-bottom: 30px;
        border: 1px solid var(--border);
      }

      h1 {
        font-size: 42px;
        margin-bottom: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 700;
      }

      .subtitle {
        color: var(--muted);
        font-size: 16px;
        margin-bottom: 30px;
      }

      /* Scan Controls */
      .scan-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .control-label {
        font-size: 13px;
        color: var(--muted);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      select {
        padding: 14px 20px;
        background: var(--bg);
        border: 2px solid var(--border);
        border-radius: 10px;
        color: var(--text);
        font-size: 15px;
        cursor: pointer;
        transition: all 0.2s;
      }

      select:hover {
        border-color: var(--accent);
      }
      select:focus {
        outline: none;
        border-color: var(--accent);
      }

      .range-container {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      input[type='range'] {
        flex: 1;
        height: 6px;
        border-radius: 5px;
        background: var(--border);
        outline: none;
        -webkit-appearance: none;
      }

      input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--accent);
        cursor: pointer;
      }

      .range-value {
        min-width: 60px;
        text-align: center;
        font-weight: 600;
        color: var(--accent);
        font-size: 16px;
      }

      .button-row {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        align-items: center;
      }

      .btn {
        padding: 14px 32px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      .btn-danger {
        background: var(--danger);
        color: white;
      }

      .btn-danger:hover {
        background: #e53e3e;
        transform: translateY(-2px);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      .scan-status {
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--accent);
        font-size: 15px;
        font-weight: 500;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .spinner {
        width: 20px;
        height: 20px;
        border: 3px solid var(--border);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      /* Logs */
      .logs-container {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 30px;
        max-height: 400px;
        overflow-y: auto;
        font-family: 'Monaco', 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.8;
        display: none;
      }

      .logs-container.active {
        display: block;
      }

      .log-line {
        padding: 6px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .log-success {
        color: var(--success);
      }
      .log-error {
        color: var(--warning);
      }
      .log-info {
        color: var(--accent);
      }

      /* Stats */
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: var(--surface);
        padding: 25px;
        border-radius: 16px;
        border: 1px solid var(--border);
        transition: all 0.3s;
      }

      .stat-card:hover {
        border-color: var(--accent);
        transform: translateY(-2px);
      }

      .stat-value {
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 8px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .stat-label {
        color: var(--muted);
        font-size: 14px;
        font-weight: 500;
      }

      /* Filters */
      .filters {
        background: var(--surface);
        padding: 25px;
        border-radius: 16px;
        margin-bottom: 20px;
        border: 1px solid var(--border);
      }

      .filter-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .filter-label {
        font-size: 13px;
        color: var(--muted);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Selection bar */
      .selection-bar {
        background: var(--accent);
        color: white;
        padding: 15px 25px;
        border-radius: 12px;
        margin-bottom: 20px;
        display: none;
        align-items: center;
        justify-content: space-between;
      }

      .selection-bar.active {
        display: flex;
      }

      .selection-count {
        font-weight: 600;
        font-size: 15px;
      }

      .selection-actions {
        display: flex;
        gap: 10px;
      }

      .btn-small {
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-small:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Table */
      .table-container {
        background: var(--surface);
        border-radius: 16px;
        border: 1px solid var(--border);
        overflow: hidden;
      }

      .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 25px;
        border-bottom: 1px solid var(--border);
      }

      .table-title {
        font-size: 20px;
        font-weight: 600;
      }

      .table-actions {
        display: flex;
        gap: 10px;
      }

      .btn-refresh {
        padding: 10px 20px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text);
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
        font-weight: 500;
      }

      .btn-refresh:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: var(--bg);
      }

      th {
        padding: 18px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      th.checkbox-col {
        width: 50px;
        text-align: center;
      }

      tbody tr {
        border-bottom: 1px solid var(--border);
        transition: background 0.2s;
      }

      tbody tr:hover {
        background: rgba(102, 126, 234, 0.05);
      }

      tbody tr.selected {
        background: rgba(102, 126, 234, 0.1);
      }

      td {
        padding: 18px;
        font-size: 14px;
      }

      .provider-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 14px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
      }

      .country-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
      }

      .domain-link {
        color: var(--accent);
        text-decoration: none;
        font-weight: 500;
      }

      .domain-link:hover {
        text-decoration: underline;
      }

      .ip-text {
        color: var(--muted);
        font-family: 'Monaco', monospace;
        font-size: 13px;
      }

      input[type='checkbox'] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: var(--accent);
      }

      /* Empty state */
      .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: var(--muted);
      }

      .empty-icon {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      /* Pagination */
      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        padding: 25px;
        border-top: 1px solid var(--border);
      }

      .pagination button {
        padding: 10px 20px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text);
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
      }

      .pagination button:hover:not(:disabled) {
        border-color: var(--accent);
        color: var(--accent);
      }

      .pagination button:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      .page-info {
        color: var(--muted);
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>‚òÅÔ∏è Cloud Host Scanner</h1>
        <p class="subtitle">D√©tection multi-providers via Shodan API</p>

        <div class="scan-controls">
          <div class="control-group">
            <span class="control-label">Pays</span>
            <select id="scanCountry">
              <optgroup label="üåç Europe">
                <option value="FR">üá´üá∑ France</option>
                <option value="AL">Albanie</option>
                <option value="DE">üá©üá™ Allemagne</option>
                <option value="AD">Andorre</option>
                <option value="AT">Autriche</option>
                <option value="BE">üáßüá™ Belgique</option>
                <option value="BY">Bi√©lorussie</option>
                <option value="BA">Bosnie-Herz√©govine</option>
                <option value="BG">Bulgarie</option>
                <option value="HR">Croatie</option>
                <option value="CY">Chypre</option>
                <option value="DK">Danemark</option>
                <option value="ES">üá™üá∏ Espagne</option>
                <option value="EE">Estonie</option>
                <option value="FI">Finlande</option>
                <option value="GR">Gr√®ce</option>
                <option value="HU">Hongrie</option>
                <option value="IE">Irlande</option>
                <option value="IS">Islande</option>
                <option value="IT">üáÆüáπ Italie</option>
                <option value="LV">Lettonie</option>
                <option value="LI">Liechtenstein</option>
                <option value="LT">Lituanie</option>
                <option value="LU">Luxembourg</option>
                <option value="MK">Mac√©doine</option>
                <option value="MT">Malte</option>
                <option value="MD">Moldavie</option>
                <option value="MC">Monaco</option>
                <option value="ME">Mont√©n√©gro</option>
                <option value="NO">Norv√®ge</option>
                <option value="NL">Pays-Bas</option>
                <option value="PL">Pologne</option>
                <option value="PT">Portugal</option>
                <option value="CZ">R√©publique tch√®que</option>
                <option value="RO">Roumanie</option>
                <option value="GB">üá¨üáß Royaume-Uni</option>
                <option value="RU">Russie</option>
                <option value="SM">Saint-Marin</option>
                <option value="RS">Serbie</option>
                <option value="SK">Slovaquie</option>
                <option value="SI">Slov√©nie</option>
                <option value="SE">Su√®de</option>
                <option value="CH">Suisse</option>
                <option value="UA">Ukraine</option>
                <option value="VA">Vatican</option>
              </optgroup>
              <optgroup label="üåç Afrique">
                <option value="ZA">Afrique du Sud</option>
                <option value="DZ">Alg√©rie</option>
                <option value="AO">Angola</option>
                <option value="BJ">B√©nin</option>
                <option value="BW">Botswana</option>
                <option value="BF">Burkina Faso</option>
                <option value="BI">Burundi</option>
                <option value="CM">Cameroun</option>
                <option value="CV">Cap-Vert</option>
                <option value="CF">R√©publique centrafricaine</option>
                <option value="TD">Tchad</option>
                <option value="KM">Comores</option>
                <option value="CG">R√©publique du Congo</option>
                <option value="CD">R√©publique d√©mocratique du Congo</option>
                <option value="CI">C√¥te d'Ivoire</option>
                <option value="DJ">Djibouti</option>
                <option value="EG">√âgypte</option>
                <option value="ER">√ârythr√©e</option>
                <option value="SZ">Eswatini</option>
                <option value="ET">√âthiopie</option>
                <option value="GA">Gabon</option>
                <option value="GM">Gambie</option>
                <option value="GH">Ghana</option>
                <option value="GN">Guin√©e</option>
                <option value="GQ">Guin√©e √©quatoriale</option>
                <option value="GW">Guin√©e-Bissau</option>
                <option value="KE">Kenya</option>
                <option value="LS">Lesotho</option>
                <option value="LR">Liberia</option>
                <option value="LY">Libye</option>
                <option value="MG">Madagascar</option>
                <option value="MW">Malawi</option>
                <option value="ML">Mali</option>
                <option value="MR">Mauritanie</option>
                <option value="MU">Maurice</option>
                <option value="MA">Maroc</option>
                <option value="MZ">Mozambique</option>
                <option value="NA">Namibie</option>
                <option value="NE">Niger</option>
                <option value="NG">Nigeria</option>
                <option value="RW">Rwanda</option>
                <option value="ST">S√£o Tom√©-et-Principe</option>
                <option value="SN">S√©n√©gal</option>
                <option value="SC">Seychelles</option>
                <option value="SL">Sierra Leone</option>
                <option value="SO">Somalie</option>
                <option value="SD">Soudan</option>
                <option value="SS">Soudan du Sud</option>
                <option value="TZ">Tanzanie</option>
                <option value="TG">Togo</option>
                <option value="TN">Tunisie</option>
                <option value="UG">Ouganda</option>
                <option value="ZM">Zambie</option>
                <option value="ZW">Zimbabwe</option>
              </optgroup>
              <optgroup label="üåé Am√©riques">
                <option value="AR">Argentine</option>
                <option value="BS">Bahamas</option>
                <option value="BB">Barbade</option>
                <option value="BZ">Belize</option>
                <option value="BO">Bolivie</option>
                <option value="BR">Br√©sil</option>
                <option value="CA">üá®üá¶ Canada</option>
                <option value="CL">Chili</option>
                <option value="CO">Colombie</option>
                <option value="CR">Costa Rica</option>
                <option value="CU">Cuba</option>
                <option value="DM">Dominique</option>
                <option value="DO">R√©publique Dominicaine</option>
                <option value="EC">√âquateur</option>
                <option value="SV">Salvador</option>
                <option value="US">√âtats-Unis</option>
                <option value="GD">Grenade</option>
                <option value="GT">Guatemala</option>
                <option value="GY">Guyana</option>
                <option value="HT">Ha√Øti</option>
                <option value="HN">Honduras</option>
                <option value="JM">Jama√Øque</option>
                <option value="MX">Mexique</option>
                <option value="NI">Nicaragua</option>
                <option value="PA">Panama</option>
                <option value="PY">Paraguay</option>
                <option value="PE">P√©rou</option>
                <option value="KN">Saint-Kitts-et-Nevis</option>
                <option value="LC">Sainte-Lucie</option>
                <option value="VC">Saint-Vincent-et-les-Grenadines</option>
                <option value="SR">Suriname</option>
                <option value="TT">Trinit√©-et-Tobago</option>
                <option value="UY">Uruguay</option>
                <option value="VE">Venezuela</option>
              </optgroup>
              <optgroup label="üåè Asie">
                <option value="AF">Afghanistan</option>
                <option value="SA">Arabie Saoudite</option>
                <option value="AM">Arm√©nie</option>
                <option value="AZ">Azerba√Ødjan</option>
                <option value="BH">Bahre√Øn</option>
                <option value="BD">Bangladesh</option>
                <option value="BT">Bhoutan</option>
                <option value="MM">Birmanie</option>
                <option value="BN">Brunei</option>
                <option value="KH">Cambodge</option>
                <option value="CN">Chine</option>
                <option value="KP">Cor√©e du Nord</option>
                <option value="KR">Cor√©e du Sud</option>
                <option value="AE">√âmirats arabes unis</option>
                <option value="GE">G√©orgie</option>
                <option value="IN">Inde</option>
                <option value="ID">Indon√©sie</option>
                <option value="IQ">Irak</option>
                <option value="IR">Iran</option>
                <option value="IL">Isra√´l</option>
                <option value="JP">Japon</option>
                <option value="JO">Jordanie</option>
                <option value="KZ">Kazakhstan</option>
                <option value="KG">Kirghizistan</option>
                <option value="KW">Kowe√Øt</option>
                <option value="LA">Laos</option>
                <option value="LB">Liban</option>
                <option value="MY">Malaisie</option>
                <option value="MV">Maldives</option>
                <option value="MN">Mongolie</option>
                <option value="NP">N√©pal</option>
                <option value="OM">Oman</option>
                <option value="UZ">Ouzb√©kistan</option>
                <option value="PK">Pakistan</option>
                <option value="PS">Palestine</option>
                <option value="PH">Philippines</option>
                <option value="QA">Qatar</option>
                <option value="SG">Singapour</option>
                <option value="LK">Sri Lanka</option>
                <option value="SY">Syrie</option>
                <option value="TJ">Tadjikistan</option>
                <option value="TH">Tha√Ølande</option>
                <option value="TL">Timor oriental</option>
                <option value="TM">Turkm√©nistan</option>
                <option value="TR">Turquie</option>
                <option value="VN">Vi√™t Nam</option>
                <option value="YE">Y√©men</option>
              </optgroup>
              <optgroup label="üåä Oc√©anie">
                <option value="AU">Australie</option>
                <option value="CK">√éles Cook</option>
                <option value="FJ">Fidji</option>
                <option value="KI">Kiribati</option>
                <option value="MH">√éles Marshall</option>
                <option value="FM">Micron√©sie</option>
                <option value="NR">Nauru</option>
                <option value="NU">Niue</option>
                <option value="NZ">Nouvelle-Z√©lande</option>
                <option value="PW">Palaos</option>
                <option value="PG">Papouasie-Nouvelle-Guin√©e</option>
                <option value="WS">Samoa</option>
                <option value="SB">Salomon</option>
                <option value="TO">Tonga</option>
                <option value="TV">Tuvalu</option>
                <option value="VU">Vanuatu</option>
              </optgroup>
            </select>
          </div>

          <div class="control-group">
            <span class="control-label">Nombre de r√©sultats</span>
            <div class="range-container">
              <input
                type="range"
                id="maxResults"
                min="50"
                max="1000"
                step="50"
                value="200"
                oninput="document.getElementById('maxResultsValue').textContent = this.value"
              />
              <span class="range-value" id="maxResultsValue">200</span>
            </div>
          </div>
        </div>

        <div class="button-row">
          <button class="btn btn-primary" onclick="startScan()" id="scanBtn">
            üöÄ Lancer le scan
          </button>

          <button class="btn btn-danger" onclick="stopScan()" id="stopBtn" style="display: none">
            ‚èπ Arr√™ter le scan
          </button>

          <div class="scan-status" id="scanStatus" style="display: none">
            <div class="spinner"></div>
            <span>Scan en cours...</span>
          </div>
        </div>
      </header>

      <div class="logs-container" id="logsContainer"></div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="statTotal">0</div>
          <div class="stat-label">Sites d√©tect√©s</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statSelected">0</div>
          <div class="stat-label">S√©lectionn√©s</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statProviders">0</div>
          <div class="stat-label">Providers</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statCountries">0</div>
          <div class="stat-label">Pays</div>
        </div>
      </div>

      <div class="selection-bar" id="selectionBar">
        <span class="selection-count"><span id="selectionCount">0</span> s√©lectionn√©(s)</span>
        <div class="selection-actions">
          <button class="btn-small" onclick="deselectAll()">Tout d√©s√©lectionner</button>
          <button class="btn-small" onclick="exportSelected()">üì• Exporter CSV</button>
        </div>
      </div>

      <div class="filters">
        <div class="filter-row">
          <div class="filter-group">
            <span class="filter-label">Provider</span>
            <select id="filterProvider" onchange="loadHosts()">
              <option value="all">Tous les providers</option>
              <option value="heroku">üü£ Heroku</option>
              <option value="aws">üü† Amazon AWS</option>
              <option value="gcp">üîµ Google Cloud</option>
              <option value="azure">üî∑ Microsoft Azure</option>
              <option value="digitalocean">üü¢ DigitalOcean</option>
              <option value="cloudflare">üü° Cloudflare</option>
              <option value="ovh">üî¥ OVH</option>
              <option value="netlify">üü§ Netlify</option>
              <option value="vercel">‚ö´ Vercel</option>
              <option value="render">üü† Render</option>
              <option value="scalingo">üá´üá∑ Scalingo</option>
              <option value="railway">üöÇ Railway</option>
              <option value="fly">‚úàÔ∏è Fly.io</option>
            </select>
          </div>

          <div class="filter-group">
            <span class="filter-label">Pays</span>
            <select id="filterCountry" onchange="loadHosts()">
              <option value="all">Tous les pays</option>
              <optgroup label="üåç Afrique">
                <option value="ZA">Afrique du Sud</option>
                <option value="DZ">Alg√©rie</option>
                <option value="AO">Angola</option>
                <option value="BJ">B√©nin</option>
                <option value="BW">Botswana</option>
                <option value="BF">Burkina Faso</option>
                <option value="BI">Burundi</option>
                <option value="CM">Cameroun</option>
                <option value="CV">Cap-Vert</option>
                <option value="CF">R√©publique centrafricaine</option>
                <option value="TD">Tchad</option>
                <option value="KM">Comores</option>
                <option value="CG">R√©publique du Congo</option>
                <option value="CD">R√©publique d√©mocratique du Congo</option>
                <option value="CI">C√¥te d'Ivoire</option>
                <option value="DJ">Djibouti</option>
                <option value="EG">√âgypte</option>
                <option value="ER">√ârythr√©e</option>
                <option value="SZ">Eswatini</option>
                <option value="ET">√âthiopie</option>
                <option value="GA">Gabon</option>
                <option value="GM">Gambie</option>
                <option value="GH">Ghana</option>
                <option value="GN">Guin√©e</option>
                <option value="GQ">Guin√©e √©quatoriale</option>
                <option value="GW">Guin√©e-Bissau</option>
                <option value="KE">Kenya</option>
                <option value="LS">Lesotho</option>
                <option value="LR">Liberia</option>
                <option value="LY">Libye</option>
                <option value="MG">Madagascar</option>
                <option value="MW">Malawi</option>
                <option value="ML">Mali</option>
                <option value="MR">Mauritanie</option>
                <option value="MU">Maurice</option>
                <option value="MA">Maroc</option>
                <option value="MZ">Mozambique</option>
                <option value="NA">Namibie</option>
                <option value="NE">Niger</option>
                <option value="NG">Nigeria</option>
                <option value="RW">Rwanda</option>
                <option value="ST">S√£o Tom√©-et-Principe</option>
                <option value="SN">S√©n√©gal</option>
                <option value="SC">Seychelles</option>
                <option value="SL">Sierra Leone</option>
                <option value="SO">Somalie</option>
                <option value="SD">Soudan</option>
                <option value="SS">Soudan du Sud</option>
                <option value="TZ">Tanzanie</option>
                <option value="TG">Togo</option>
                <option value="TN">Tunisie</option>
                <option value="UG">Ouganda</option>
                <option value="ZM">Zambie</option>
                <option value="ZW">Zimbabwe</option>
              </optgroup>
              <optgroup label="üåé Am√©riques">
                <option value="AR">Argentine</option>
                <option value="BS">Bahamas</option>
                <option value="BB">Barbade</option>
                <option value="BZ">Belize</option>
                <option value="BO">Bolivie</option>
                <option value="BR">Br√©sil</option>
                <option value="CA">Canada</option>
                <option value="CL">Chili</option>
                <option value="CO">Colombie</option>
                <option value="CR">Costa Rica</option>
                <option value="CU">Cuba</option>
                <option value="DM">Dominique</option>
                <option value="DO">R√©publique Dominicaine</option>
                <option value="EC">√âquateur</option>
                <option value="SV">Salvador</option>
                <option value="US">√âtats-Unis</option>
                <option value="GD">Grenade</option>
                <option value="GT">Guatemala</option>
                <option value="GY">Guyana</option>
                <option value="HT">Ha√Øti</option>
                <option value="HN">Honduras</option>
                <option value="JM">Jama√Øque</option>
                <option value="MX">Mexique</option>
                <option value="NI">Nicaragua</option>
                <option value="PA">Panama</option>
                <option value="PY">Paraguay</option>
                <option value="PE">P√©rou</option>
                <option value="KN">Saint-Kitts-et-Nevis</option>
                <option value="LC">Sainte-Lucie</option>
                <option value="VC">Saint-Vincent-et-les-Grenadines</option>
                <option value="SR">Suriname</option>
                <option value="TT">Trinit√©-et-Tobago</option>
                <option value="UY">Uruguay</option>
                <option value="VE">Venezuela</option>
              </optgroup>
              <optgroup label="üåè Asie">
                <option value="AF">Afghanistan</option>
                <option value="SA">Arabie Saoudite</option>
                <option value="AM">Arm√©nie</option>
                <option value="AZ">Azerba√Ødjan</option>
                <option value="BH">Bahre√Øn</option>
                <option value="BD">Bangladesh</option>
                <option value="BT">Bhoutan</option>
                <option value="MM">Birmanie</option>
                <option value="BN">Brunei</option>
                <option value="KH">Cambodge</option>
                <option value="CN">Chine</option>
                <option value="KP">Cor√©e du Nord</option>
                <option value="KR">Cor√©e du Sud</option>
                <option value="AE">√âmirats arabes unis</option>
                <option value="GE">G√©orgie</option>
                <option value="IN">Inde</option>
                <option value="ID">Indon√©sie</option>
                <option value="IQ">Irak</option>
                <option value="IR">Iran</option>
                <option value="IL">Isra√´l</option>
                <option value="JP">Japon</option>
                <option value="JO">Jordanie</option>
                <option value="KZ">Kazakhstan</option>
                <option value="KG">Kirghizistan</option>
                <option value="KW">Kowe√Øt</option>
                <option value="LA">Laos</option>
                <option value="LB">Liban</option>
                <option value="MY">Malaisie</option>
                <option value="MV">Maldives</option>
                <option value="MN">Mongolie</option>
                <option value="NP">N√©pal</option>
                <option value="OM">Oman</option>
                <option value="UZ">Ouzb√©kistan</option>
                <option value="PK">Pakistan</option>
                <option value="PS">Palestine</option>
                <option value="PH">Philippines</option>
                <option value="QA">Qatar</option>
                <option value="SG">Singapour</option>
                <option value="LK">Sri Lanka</option>
                <option value="SY">Syrie</option>
                <option value="TJ">Tadjikistan</option>
                <option value="TH">Tha√Ølande</option>
                <option value="TL">Timor oriental</option>
                <option value="TM">Turkm√©nistan</option>
                <option value="TR">Turquie</option>
                <option value="VN">Vi√™t Nam</option>
                <option value="YE">Y√©men</option>
              </optgroup>
              <optgroup label="üåç Europe">
                <option value="AL">Albanie</option>
                <option value="DE">Allemagne</option>
                <option value="AD">Andorre</option>
                <option value="AT">Autriche</option>
                <option value="BE">Belgique</option>
                <option value="BY">Bi√©lorussie</option>
                <option value="BA">Bosnie-Herz√©govine</option>
                <option value="BG">Bulgarie</option>
                <option value="HR">Croatie</option>
                <option value="CY">Chypre</option>
                <option value="DK">Danemark</option>
                <option value="ES">Espagne</option>
                <option value="EE">Estonie</option>
                <option value="FI">Finlande</option>
                <option value="FR">France</option>
                <option value="GR">Gr√®ce</option>
                <option value="HU">Hongrie</option>
                <option value="IE">Irlande</option>
                <option value="IS">Islande</option>
                <option value="IT">Italie</option>
                <option value="LV">Lettonie</option>
                <option value="LI">Liechtenstein</option>
                <option value="LT">Lituanie</option>
                <option value="LU">Luxembourg</option>
                <option value="MK">Mac√©doine</option>
                <option value="MT">Malte</option>
                <option value="MD">Moldavie</option>
                <option value="MC">Monaco</option>
                <option value="ME">Mont√©n√©gro</option>
                <option value="NO">Norv√®ge</option>
                <option value="NL">Pays-Bas</option>
                <option value="PL">Pologne</option>
                <option value="PT">Portugal</option>
                <option value="CZ">R√©publique tch√®que</option>
                <option value="RO">Roumanie</option>
                <option value="GB">Royaume-Uni</option>
                <option value="RU">Russie</option>
                <option value="SM">Saint-Marin</option>
                <option value="RS">Serbie</option>
                <option value="SK">Slovaquie</option>
                <option value="SI">Slov√©nie</option>
                <option value="SE">Su√®de</option>
                <option value="CH">Suisse</option>
                <option value="UA">Ukraine</option>
                <option value="VA">Vatican</option>
              </optgroup>
              <optgroup label="üåä Oc√©anie">
                <option value="AU">Australie</option>
                <option value="CK">√éles Cook</option>
                <option value="FJ">Fidji</option>
                <option value="KI">Kiribati</option>
                <option value="MH">√éles Marshall</option>
                <option value="FM">Micron√©sie</option>
                <option value="NR">Nauru</option>
                <option value="NU">Niue</option>
                <option value="NZ">Nouvelle-Z√©lande</option>
                <option value="PW">Palaos</option>
                <option value="PG">Papouasie-Nouvelle-Guin√©e</option>
                <option value="WS">Samoa</option>
                <option value="SB">Salomon</option>
                <option value="TO">Tonga</option>
                <option value="TV">Tuvalu</option>
                <option value="VU">Vanuatu</option>
              </optgroup>
            </select>
          </div>
        </div>
      </div>

      <div class="table-container">
        <div class="table-header">
          <div class="table-title">R√©sultats</div>
          <div class="table-actions">
            <button class="btn-refresh" onclick="selectAllPages()">‚òëÔ∏è Tout s√©lectionner</button>
            <button class="btn-refresh" onclick="loadHosts()">üîÑ Actualiser</button>
          </div>
        </div>

        <div id="tableContent">
          <div class="empty-state">
            <div class="empty-icon">üîç</div>
            <p>Lancez un scan pour d√©tecter les sites h√©berg√©s sur le cloud</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      let currentPage = 1;
      let scanInterval = null;
      let selectedIds = new Set();

      async function startScan() {
        const country = document.getElementById('scanCountry').value;
        const maxResults = document.getElementById('maxResults').value;
        const btn = document.getElementById('scanBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('scanStatus');
        const logsContainer = document.getElementById('logsContainer');

        btn.disabled = true;
        stopBtn.style.display = 'flex';
        status.style.display = 'flex';
        logsContainer.classList.add('active');
        logsContainer.innerHTML =
          '<div class="log-line log-info">üöÄ Lancement du scan Shodan...</div>';

        try {
          const resp = await fetch(`/api/trigger-scan?country=${country}&limit=${maxResults}`);
          const data = await resp.json();

          addLog(`‚úÖ Scan lanc√© pour ${country} (max ${maxResults} r√©sultats)`, 'success');
          addLog(`‚è≥ Le scan peut prendre quelques minutes...`, 'info');

          scanInterval = setInterval(() => {
            loadStats();
            loadHosts();
          }, 5000);
        } catch (err) {
          addLog(`‚ùå Erreur: ${err.message}`, 'error');
          stopScan();
        }
      }

      function stopScan() {
        if (scanInterval) {
          clearInterval(scanInterval);
          scanInterval = null;
        }

        document.getElementById('scanBtn').disabled = false;
        document.getElementById('stopBtn').style.display = 'none';
        document.getElementById('scanStatus').style.display = 'none';

        addLog('‚èπ Scan arr√™t√©', 'info');
        loadHosts();
        loadStats();
      }

      function addLog(message, type = 'info') {
        const logsContainer = document.getElementById('logsContainer');
        const logLine = document.createElement('div');
        logLine.className = `log-line log-${type}`;
        logLine.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logsContainer.appendChild(logLine);
        logsContainer.scrollTop = logsContainer.scrollHeight;
      }

      async function loadHosts(page = 1) {
        const provider = document.getElementById('filterProvider').value;
        const country = document.getElementById('filterCountry').value;

        const params = new URLSearchParams({
          provider,
          country,
          selected: 'false',
          page,
          per_page: 50,
        });

        try {
          const resp = await fetch(`/api/hosts?${params}`);
          const data = await resp.json();
          currentPage = page;
          renderTable(data);
        } catch (err) {
          document.getElementById('tableContent').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ùå</div>
            <p>Erreur de chargement</p>
          </div>
        `;
        }
      }

      async function loadStats() {
        try {
          const resp = await fetch('/api/stats');
          const data = await resp.json();

          document.getElementById('statTotal').textContent = data.total.toLocaleString();
          document.getElementById('statProviders').textContent = data.by_provider.length;
          document.getElementById('statCountries').textContent = data.by_country.length;
          updateSelectionCount();
        } catch (err) {
          console.error('Erreur stats:', err);
        }
      }

      function renderTable(data) {
        const { hosts, total, page, pages } = data;

        if (hosts.length === 0) {
          document.getElementById('tableContent').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üîç</div>
            <p>Aucun r√©sultat trouv√©</p>
          </div>
        `;
          return;
        }

        const PROVIDERS = {
          heroku: { icon: 'üü£', name: 'Heroku', color: '#6762a6' },
          aws: { icon: 'üü†', name: 'AWS', color: '#ff9900' },
          gcp: { icon: 'üîµ', name: 'GCP', color: '#4285f4' },
          azure: { icon: 'üî∑', name: 'Azure', color: '#0078d4' },
          digitalocean: { icon: 'üü¢', name: 'DigitalOcean', color: '#0080ff' },
          cloudflare: { icon: 'üü°', name: 'Cloudflare', color: '#f38020' },
          ovh: { icon: 'üî¥', name: 'OVH', color: '#123f6d' },
          netlify: { icon: 'üü§', name: 'Netlify', color: '#00c7b7' },
          vercel: { icon: '‚ö´', name: 'Vercel', color: '#000000' },
          render: { icon: 'üü†', name: 'Render', color: '#46e3b7' },
          scalingo: { icon: 'üá´üá∑', name: 'Scalingo', color: '#3b4aff' },
          railway: { icon: 'üöÇ', name: 'Railway', color: '#0b0d0e' },
          fly: { icon: '‚úàÔ∏è', name: 'Fly.io', color: '#7b3ff2' },
        };

        const COUNTRIES = {
          FR: { icon: 'üá´üá∑', name: 'France' },
          BE: { icon: 'üáßüá™', name: 'Belgique' },
          GB: { icon: 'üá¨üáß', name: 'UK' },
          US: { icon: 'üá∫üá∏', name: 'USA' },
          DE: { icon: 'üá©üá™', name: 'Allemagne' },
        };

        let html = `
        <table>
          <thead>
            <tr>
              <th class="checkbox-col">
                <input type="checkbox" onclick="toggleAllOnPage()" id="selectAllPage">
              </th>
              <th>Domain / IP</th>
              <th>Provider</th>
              <th>Pays</th>
              <th>Status</th>
              <th>D√©couvert</th>
            </tr>
          </thead>
          <tbody>
      `;

        hosts.forEach((h) => {
          const providerInfo = PROVIDERS[h.provider] || {
            icon: '‚ùì',
            name: h.provider,
            color: '#888',
          };
          const countryInfo = COUNTRIES[h.country] || { icon: 'üåç', name: h.country };
          const isSelected = selectedIds.has(h.id);

          html += `
          <tr class="${isSelected ? 'selected' : ''}">
            <td style="text-align: center;">
              <input type="checkbox"
                     ${isSelected ? 'checked' : ''}
                     onchange="toggleSelection(${h.id})"
                     data-id="${h.id}">
            </td>
            <td>
              <a href="http://${h.domain || h.ip}" target="_blank" class="domain-link">
                ${h.domain || h.ip}
              </a>
              ${h.domain ? `<br><span class="ip-text">${h.ip}</span>` : ''}
            </td>
            <td>
              <span class="provider-badge" style="background: ${providerInfo.color}22; color: ${providerInfo.color}">
                ${providerInfo.icon} ${providerInfo.name}
              </span>
            </td>
            <td>
              <span class="country-badge">
                ${countryInfo.icon} ${countryInfo.name}
              </span>
            </td>
            <td>${h.status_code || '-'}</td>
            <td style="color: var(--muted); font-size: 13px;">
              ${new Date(h.discovered_at).toLocaleString('fr-FR')}
            </td>
          </tr>
        `;
        });

        html += `
          </tbody>
        </table>
        <div class="pagination">
          <button onclick="loadHosts(${page - 1})" ${page === 1 ? 'disabled' : ''}>
            ‚Üê Pr√©c√©dent
          </button>
          <span class="page-info">
            Page ${page} / ${pages} (${total.toLocaleString()} r√©sultats)
          </span>
          <button onclick="loadHosts(${page + 1})" ${page === pages ? 'disabled' : ''}>
            Suivant ‚Üí
          </button>
        </div>
      `;

        document.getElementById('tableContent').innerHTML = html;
      }

      function toggleSelection(id) {
        if (selectedIds.has(id)) {
          selectedIds.delete(id);
        } else {
          selectedIds.add(id);
        }
        updateSelectionCount();
        loadHosts(currentPage);
      }

      function toggleAllOnPage() {
        const checkbox = document.getElementById('selectAllPage');
        const checkboxes = document.querySelectorAll('tbody input[type="checkbox"]');

        checkboxes.forEach((cb) => {
          const id = parseInt(cb.dataset.id);
          if (checkbox.checked) {
            selectedIds.add(id);
          } else {
            selectedIds.delete(id);
          }
        });

        updateSelectionCount();
        loadHosts(currentPage);
      }

      async function selectAllPages() {
        if (!confirm('Voulez-vous s√©lectionner TOUS les r√©sultats (toutes pages) ?')) {
          return;
        }

        try {
          const provider = document.getElementById('filterProvider').value;
          const country = document.getElementById('filterCountry').value;
          const params = new URLSearchParams({
            provider,
            country,
            selected: 'false',
            page: 1,
            per_page: 10000,
          });

          const resp = await fetch(`/api/hosts?${params}`);
          const data = await resp.json();

          data.hosts.forEach((h) => selectedIds.add(h.id));
          updateSelectionCount();
          loadHosts(currentPage);
        } catch (err) {
          alert('Erreur lors de la s√©lection');
        }
      }

      function deselectAll() {
        selectedIds.clear();
        updateSelectionCount();
        loadHosts(currentPage);
      }

      function updateSelectionCount() {
        const count = selectedIds.size;
        document.getElementById('statSelected').textContent = count.toLocaleString();
        document.getElementById('selectionCount').textContent = count;

        const bar = document.getElementById('selectionBar');
        bar.classList.toggle('active', count > 0);
      }

      async function exportSelected() {
        if (selectedIds.size === 0) {
          alert('Aucune s√©lection √† exporter');
          return;
        }

        const ids = Array.from(selectedIds).join(',');
        window.location.href = `/api/export?ids=${ids}`;
      }

      loadHosts();
      loadStats();
      setInterval(() => {
        if (!scanInterval) loadStats();
      }, 30000);
    </script>
  </body>
</html>
